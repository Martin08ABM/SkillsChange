
---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import NavBar from '../../components/NavBar.astro';
import { getDb } from '../../lib/db';

const { userId, redirectToSignIn } = Astro.locals.auth();
if (!userId) {
  return redirectToSignIn();
}

const { id } = Astro.params;

let service = null;
let error = null;

try {
  const db = await getDb();
  service = await db.get('SELECT * FROM services WHERE id = ? AND user_id = ?', [id, userId]);
  if (!service) {
    error = 'Anuncio no encontrado o no tienes permiso para editarlo.';
  }
} catch (e) {
  console.error('Error fetching service for edit:', e);
  error = 'Error al cargar el anuncio.';
}
---

<Layout title="Editar Anuncio">
  <Header />
  <NavBar />

  <div class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-4">Editar Anuncio</h1>
    </div>

    {error && (
      <p class="text-red-500 text-center bg-red-100 p-4 rounded-lg">{error}</p>
    )}

    {service && (
      <div class="max-w-lg mx-auto bg-white p-8 rounded-xl shadow-lg border-2 border-black">
        <h2 class="text-2xl font-bold mb-2">{service.title}</h2>
        <p class="text-gray-500 mb-6">ID: {service.id}</p>
        
        <div class="text-center bg-blue-100 p-6 rounded-lg">
          <h3 class="text-xl font-bold text-blue-800">Próximamente</h3>
          <p class="text-blue-700 mt-2">La funcionalidad para editar anuncios estará disponible pronto. ¡Gracias por tu paciencia!</p>
        </div>
      </div>
    )}

  </div>

  <Footer />
</Layout>
